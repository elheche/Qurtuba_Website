<div class="user-profil-container">
  <mat-toolbar color="primary" [class.mat-elevation-z4]="true">
    <a mat-icon-button matTooltip="Home" href="http://localhost:4200">
      <mat-icon>home</mat-icon>
    </a>
    <a mat-icon-button matTooltip="Logout" href="http://localhost:4200/logout">
      <mat-icon>logout</mat-icon>
    </a>
  </mat-toolbar>
  <mat-card class="user-profil-form-container">
    <mat-card-header>
      <mat-card-title>My account</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <mat-tab-group>
        <mat-tab label="Login informations">
          <form [formGroup]="registrationFormStep1" id="registration-form-step-1">
            <mat-form-field appearance="outline">
              <mat-label>Email</mat-label>
              <input
                matInput
                type="email"
                placeholder="user@example.com"
                formControlName="email"
                required
                [readonly]="environment.inputs.email.readonly"
              />
              <mat-error *ngIf="registrationFormStep1.get('email').invalid">
                {{ getErrorMessage('registrationFormStep1', 'email') }}
              </mat-error>
              <button mat-icon-button matPrefix disabled>
                <mat-icon>email</mat-icon>
              </button>
            </mat-form-field>
            <mat-form-field
              appearance="outline"
              hintLabel="{{
                environment.inputs.password.readonly
                  ? ''
                  : 'Your password must contain at least 8 characters with at least 1 numeric character, 1 uppercase letter, 1 lowercase letter and 1 special character.'
              }}"
            >
              <mat-label>Password</mat-label>
              <input
                matInput
                [type]="hide ? 'password' : 'text'"
                formControlName="password"
                required
                (input)="onPasswordValueChange()"
                #passwordInput
                maxlength="32"
                [readonly]="environment.inputs.password.readonly"
              />
              <mat-hint align="end" *ngIf="!environment.inputs.password.readonly"> {{ passwordInput.value?.length || 0 }}/32</mat-hint>
              <mat-error *ngIf="registrationFormStep1.get('password').invalid">
                {{ getErrorMessage('registrationFormStep1', 'password') }}
              </mat-error>
              <button mat-icon-button matPrefix disabled>
                <mat-icon>lock</mat-icon>
              </button>
              <button
                type="button"
                mat-icon-button
                matSuffix
                (click)="hide = !hide"
                [attr.aria-label]="'Hide password'"
                [attr.aria-pressed]="hide"
                matTooltip="{{ hide ? 'Show password' : 'Hide password' }}"
              >
                <mat-icon>{{ hide ? 'visibility_off' : 'visibility' }}</mat-icon>
              </button>
              <button
                type="button"
                mat-icon-button
                matSuffix
                (click)="onEdit('password')"
                matTooltip="{{ environment.inputs.password.readonly ? 'Edit this field' : 'Save modifications' }}"
              >
                <mat-icon>{{ environment.inputs.password.readonly ? 'edit' : 'save' }}</mat-icon>
              </button>
            </mat-form-field>
            <mat-form-field appearance="outline" *ngIf="!environment.inputs.password.readonly">
              <mat-label>Confirm your password</mat-label>
              <input
                matInput
                [type]="hide ? 'password' : 'text'"
                formControlName="confirmPassword"
                required
                [readonly]="environment.inputs.confirmPassword.readonly"
              />
              <mat-error *ngIf="registrationFormStep1.get('confirmPassword').invalid">
                {{ getErrorMessage('registrationFormStep1', 'confirmPassword') }}</mat-error
              >
              <button mat-icon-button matPrefix disabled>
                <mat-icon>lock</mat-icon>
              </button>
              <button
                type="button"
                mat-icon-button
                matSuffix
                (click)="hide = !hide"
                [attr.aria-label]="'Hide password'"
                [attr.aria-pressed]="hide"
                matTooltip="{{ hide ? 'Show password' : 'Hide password' }}"
              >
                <mat-icon>{{ hide ? 'visibility_off' : 'visibility' }}</mat-icon>
              </button>
            </mat-form-field>
          </form>
        </mat-tab>
        <mat-tab label="Personal informations">
          <form [formGroup]="registrationFormStep2" id="registration-form-step-2" #registrationFormStep2Ref="ngForm">
            <mat-form-field appearance="outline">
              <mat-label>Type of membership</mat-label>
              <mat-select formControlName="membershipType" required *ngIf="!environment.inputs.membershipType.readonly">
                <mat-option>--</mat-option>
                <mat-option *ngFor="let membershipType of environment.inputs.membershipType.types" [value]="membershipType">
                  {{ membershipType }}
                </mat-option>
              </mat-select>
              <input
                matInput
                formControlName="membershipType"
                required
                [readonly]="environment.inputs.membershipType.readonly"
                *ngIf="environment.inputs.membershipType.readonly"
              />
              <mat-error *ngIf="registrationFormStep2.get('membershipType').invalid">
                {{ getErrorMessage('registrationFormStep2', 'membershipType') }}
              </mat-error>
            </mat-form-field>
            <mat-form-field appearance="outline">
              <mat-label>Type of account</mat-label>
              <mat-select
                formControlName="accountType"
                required
                (selectionChange)="onAccountTypeSelectionChange()"
                *ngIf="!environment.inputs.accountType.readonly"
              >
                <mat-option>--</mat-option>
                <mat-option *ngFor="let accountType of environment.inputs.accountType.types" [value]="accountType">
                  {{ accountType }}
                </mat-option>
              </mat-select>
              <input
                matInput
                formControlName="accountType"
                required
                [readonly]="environment.inputs.accountType.readonly"
                *ngIf="environment.inputs.accountType.readonly"
              />
              <mat-error *ngIf="registrationFormStep2.get('accountType').invalid">
                {{ getErrorMessage('registrationFormStep2', 'accountType') }}
              </mat-error>
            </mat-form-field>
            <mat-form-field appearance="outline">
              <mat-label>First name</mat-label>
              <input
                matInput
                formControlName="firstName"
                required
                [value]="registrationFormStep2.get('firstName').value | titlecase"
                [readonly]="environment.inputs.firstName.readonly"
              />
              <mat-error *ngIf="registrationFormStep2.get('firstName').invalid">
                {{ getErrorMessage('registrationFormStep2', 'firstName') }}
              </mat-error>
            </mat-form-field>
            <mat-form-field appearance="outline">
              <mat-label>Last name</mat-label>
              <input
                matInput
                formControlName="lastName"
                required
                [value]="registrationFormStep2.get('lastName').value | titlecase"
                [readonly]="environment.inputs.lastName.readonly"
              />
              <mat-error *ngIf="registrationFormStep2.get('lastName').invalid">
                {{ getErrorMessage('registrationFormStep2', 'lastName') }}
              </mat-error>
            </mat-form-field>
            <mat-form-field appearance="outline">
              <mat-label>Birth day</mat-label>
              <input
                matInput
                type="date"
                formControlName="birthDay"
                required
                [min]="environment.inputs.birthDay.acceptedRange.minDate"
                [max]="environment.inputs.birthDay.acceptedRange.maxDate"
                [readonly]="environment.inputs.birthDay.readonly"
              />
              <mat-error *ngIf="registrationFormStep2.get('birthDay').invalid">
                {{ getErrorMessage('registrationFormStep2', 'birthDay') }}
              </mat-error>
            </mat-form-field>
            <mat-form-field appearance="outline">
              <mat-label>Phone number</mat-label>
              <input
                matInput
                type="tel"
                formControlName="phoneNumber"
                maxlength="14"
                required
                (input)="formatPhoneNumber($event, 'registrationFormStep2', 'phoneNumber')"
                placeholder="Ex. (555) 555-1234"
                [readonly]="environment.inputs.phoneNumber.readonly"
              />
              <mat-error *ngIf="registrationFormStep2.get('phoneNumber').invalid">
                {{ getErrorMessage('registrationFormStep2', 'phoneNumber') }}
              </mat-error>
            </mat-form-field>
            <mat-form-field appearance="outline">
              <mat-label>Address</mat-label>
              <input
                matInput
                formControlName="address"
                required
                placeholder="Ex. 123 Main St Apt 10"
                [value]="registrationFormStep2.get('address').value | titlecase"
                [readonly]="environment.inputs.address.readonly"
              />
              <mat-error *ngIf="registrationFormStep2.get('address').invalid">
                {{ getErrorMessage('registrationFormStep2', 'address') }}
              </mat-error>
            </mat-form-field>
            <mat-form-field appearance="outline">
              <mat-label>City</mat-label>
              <input
                matInput
                formControlName="city"
                required
                placeholder="Ex. Montreal"
                [value]="registrationFormStep2.get('city').value | titlecase"
                [readonly]="environment.inputs.city.readonly"
              />
              <mat-error *ngIf="registrationFormStep2.get('city').invalid">
                {{ getErrorMessage('registrationFormStep2', 'city') }}
              </mat-error>
            </mat-form-field>
            <mat-form-field appearance="outline">
              <mat-label>Country</mat-label>
              <mat-select
                formControlName="country"
                required
                (selectionChange)="onCountryValueChange('registrationFormStep2')"
                *ngIf="!environment.inputs.country.readonly"
              >
                <mat-option>--</mat-option>
                <mat-option *ngFor="let country of countries" [value]="country.countryName">
                  <mat-icon svgIcon="{{ 'flag-'.concat(country.countryShortCode.toLowerCase()) }}"></mat-icon>
                  {{ country.countryName }}
                </mat-option>
              </mat-select>
              <input
                matInput
                formControlName="country"
                required
                [readonly]="environment.inputs.country.readonly"
                *ngIf="environment.inputs.country.readonly"
              />
              <mat-error *ngIf="registrationFormStep2.get('country').invalid">
                {{ getErrorMessage('registrationFormStep2', 'country') }}
              </mat-error>
            </mat-form-field>
            <mat-form-field appearance="outline">
              <mat-label>State/Province/Region</mat-label>
              <mat-select formControlName="province" required *ngIf="!environment.inputs.province.readonly">
                <mat-option>--</mat-option>
                <mat-option
                  *ngFor="
                    let province of countries[findSelectedCountryIndex('registrationFormStep2')]
                      ? countries[findSelectedCountryIndex('registrationFormStep2')].regions
                      : []
                  "
                  [value]="province.name"
                >
                  {{ province.name }} ({{ province.shortCode }})
                </mat-option>
              </mat-select>
              <input
                matInput
                formControlName="province"
                required
                [readonly]="environment.inputs.province.readonly"
                *ngIf="environment.inputs.province.readonly"
              />
              <mat-error *ngIf="registrationFormStep2.get('province').invalid">
                {{ getErrorMessage('registrationFormStep2', 'province') }}
              </mat-error>
            </mat-form-field>
            <mat-form-field appearance="outline">
              <mat-label>Zip/Postal code</mat-label>
              <input
                matInput
                formControlName="postalCode"
                maxlength="14"
                required
                [value]="registrationFormStep2.get('postalCode').value | uppercase"
                (input)="formatCanadianPostalCode($event, 'registrationFormStep2')"
                placeholder="Ex. J4K 5G7"
                [readonly]="environment.inputs.postalCode.readonly"
              />
              <mat-error *ngIf="registrationFormStep2.get('postalCode').invalid">
                {{ getErrorMessage('registrationFormStep2', 'postalCode') }}
              </mat-error>
            </mat-form-field>
          </form>
          <form [formGroup]="registrationFormStep3" id="registration-form-step-3">
            <mat-form-field appearance="outline">
              <mat-label>Social Insurance Number</mat-label>
              <input
                matInput
                formControlName="socialInsuranceNumber"
                maxlength="11"
                required
                (input)="formatSocialInsuranceNumber($event, 'registrationFormStep3')"
                placeholder="Ex. 111-111-111"
                (blur)="formatSocialInsuranceNumber($event, 'registrationFormStep3')"
                [readonly]="environment.inputs.socialInsuranceNumber.readonly"
              />
              <mat-error *ngIf="registrationFormStep3.get('socialInsuranceNumber').invalid">
                {{ getErrorMessage('registrationFormStep3', 'socialInsuranceNumber') }}
              </mat-error>
            </mat-form-field>
            <mat-form-field appearance="outline">
              <mat-label>Citizenship</mat-label>
              <mat-select formControlName="citizenship" required *ngIf="!environment.inputs.citizenship.readonly">
                <mat-option>--</mat-option>
                <mat-option *ngFor="let country of countries" [value]="country.countryName">
                  <mat-icon svgIcon="{{ 'flag-'.concat(country.countryShortCode.toLowerCase()) }}"></mat-icon>
                  {{ country.countryName }}
                </mat-option>
              </mat-select>
              <input
                matInput
                formControlName="citizenship"
                required
                [readonly]="environment.inputs.citizenship.readonly"
                *ngIf="environment.inputs.citizenship.readonly"
              />
              <mat-error *ngIf="registrationFormStep3.get('citizenship').invalid">
                {{ getErrorMessage('registrationFormStep3', 'citizenship') }}
              </mat-error>
            </mat-form-field>
            <mat-form-field appearance="outline">
              <mat-label>Profession</mat-label>
              <input
                matInput
                formControlName="profession"
                required
                [value]="registrationFormStep3.get('profession').value | titlecase"
                [readonly]="environment.inputs.profession.readonly"
              />
              <mat-error *ngIf="registrationFormStep3.get('profession').invalid">
                {{ getErrorMessage('registrationFormStep3', 'profession') }}
              </mat-error>
            </mat-form-field>
            <mat-form-field appearance="outline">
              <mat-label>Employer</mat-label>
              <input
                matInput
                formControlName="employer"
                required
                [value]="registrationFormStep3.get('employer').value | titlecase"
                [readonly]="environment.inputs.employer.readonly"
              />
              <mat-error *ngIf="registrationFormStep3.get('employer').invalid">
                {{ getErrorMessage('registrationFormStep3', 'employer') }}
              </mat-error>
            </mat-form-field>
            <mat-form-field appearance="outline">
              <mat-label>Employer phone number</mat-label>
              <input
                matInput
                type="tel"
                formControlName="employerPhoneNumber"
                maxlength="14"
                required
                (input)="formatPhoneNumber($event, 'registrationFormStep3', 'employerPhoneNumber')"
                placeholder="Ex. (555) 555-1234"
                [readonly]="environment.inputs.employerPhoneNumber.readonly"
              />
              <mat-error *ngIf="registrationFormStep3.get('employerPhoneNumber').invalid">
                {{ getErrorMessage('registrationFormStep3', 'employerPhoneNumber') }}
              </mat-error>
            </mat-form-field>
            <mat-form-field appearance="outline">
              <mat-label>Number of dependents</mat-label>
              <input
                matInput
                type="number"
                formControlName="numberOfDependents"
                required
                step="1"
                min="0"
                max="15"
                oninput="validity.valid||(value='');"
                [readonly]="environment.inputs.numberOfDependents.readonly"
              />
              <mat-error *ngIf="registrationFormStep3.get('numberOfDependents').invalid">
                {{ getErrorMessage('registrationFormStep3', 'numberOfDependents') }}
              </mat-error>
            </mat-form-field>
            <mat-form-field appearance="outline">
              <mat-label>Deposit amount</mat-label>
              <input
                matInput
                type="number"
                formControlName="depositAmount"
                required
                step="1"
                min="0"
                oninput="validity.valid||(value='')"
                class="deposit-amount"
                (input)="updateTotalAmount()"
                [readonly]="environment.inputs.depositAmount.readonly"
              />
              <span matSuffix class="deposit-amount-suffix">.00 </span>
              <span matSuffix class="deposit-amount-suffix">$&nbsp;</span>
              <mat-error *ngIf="registrationFormStep3.get('depositAmount').invalid">
                {{ getErrorMessage('registrationFormStep3', 'depositAmount') }}
              </mat-error>
            </mat-form-field>
            <mat-form-field appearance="outline">
              <mat-label>Donation for mosque</mat-label>
              <input
                matInput
                type="number"
                formControlName="donationForMosque"
                required
                step="1"
                min="0"
                oninput="validity.valid||(value='')"
                class="deposit-amount"
                (input)="updateTotalAmount()"
                [readonly]="environment.inputs.donationForMosque.readonly"
              />
              <span matSuffix class="deposit-amount-suffix">.00 </span>
              <span matSuffix class="deposit-amount-suffix">$&nbsp;</span>
              <mat-error *ngIf="registrationFormStep3.get('donationForMosque').invalid">
                {{ getErrorMessage('registrationFormStep3', 'donationForMosque') }}
              </mat-error>
            </mat-form-field>
            <mat-form-field appearance="outline" hintLabel="$75.00 non-refundable.">
              <mat-label>Membership Fee</mat-label>
              <input
                matInput
                type="number"
                formControlName="membershipFee"
                step="1"
                min="0"
                class="deposit-amount"
                [readonly]="environment.inputs.membershipFee.readonly"
              />
              <span matSuffix class="deposit-amount-suffix">.00 </span>
              <span matSuffix class="deposit-amount-suffix">$&nbsp;</span>
            </mat-form-field>
            <mat-form-field appearance="outline">
              <mat-label>Total amount</mat-label>
              <input matInput type="number" formControlName="totalAmount" step="1" min="0" class="deposit-amount" readonly />
              <span matSuffix class="deposit-amount-suffix">.00 </span>
              <span matSuffix class="deposit-amount-suffix">$&nbsp;</span>
            </mat-form-field>
          </form>
        </mat-tab>
        <mat-tab label="Joint member informations">
          <form [formGroup]="registrationFormStep4" id="registration-form-step-4">
            <mat-form-field appearance="outline">
              <mat-label>First name</mat-label>
              <input
                matInput
                formControlName="firstName"
                required
                [value]="registrationFormStep4.get('firstName').value | titlecase"
                [readonly]="environment.inputs.firstName.readonly"
              />
              <mat-error *ngIf="registrationFormStep4.get('firstName').invalid">
                {{ getErrorMessage('registrationFormStep4', 'firstName') }}
              </mat-error>
            </mat-form-field>
            <mat-form-field appearance="outline">
              <mat-label>Last name</mat-label>
              <input
                matInput
                formControlName="lastName"
                required
                [value]="registrationFormStep4.get('lastName').value | titlecase"
                [readonly]="environment.inputs.lastName.readonly"
              />
              <mat-error *ngIf="registrationFormStep4.get('lastName').invalid">
                {{ getErrorMessage('registrationFormStep4', 'lastName') }}
              </mat-error>
            </mat-form-field>
            <mat-form-field appearance="outline">
              <mat-label>Address</mat-label>
              <input
                matInput
                formControlName="address"
                required
                placeholder="Ex. 123 Main St Apt 10"
                [value]="registrationFormStep4.get('address').value | titlecase"
                [readonly]="environment.inputs.address.readonly"
              />
              <mat-error *ngIf="registrationFormStep4.get('address').invalid">
                {{ getErrorMessage('registrationFormStep4', 'address') }}
              </mat-error>
            </mat-form-field>
            <mat-form-field appearance="outline">
              <mat-label>City</mat-label>
              <input
                matInput
                formControlName="city"
                required
                placeholder="Ex. Montreal"
                [value]="registrationFormStep4.get('city').value | titlecase"
                [readonly]="environment.inputs.city.readonly"
              />
              <mat-error *ngIf="registrationFormStep4.get('city').invalid">
                {{ getErrorMessage('registrationFormStep4', 'city') }}
              </mat-error>
            </mat-form-field>
            <mat-form-field appearance="outline">
              <mat-label>Country</mat-label>
              <mat-select
                formControlName="country"
                required
                (selectionChange)="onCountryValueChange('registrationFormStep4')"
                *ngIf="!environment.inputs.country.readonly"
              >
                <mat-option>--</mat-option>
                <mat-option *ngFor="let country of countries" [value]="country.countryName">
                  <mat-icon svgIcon="{{ 'flag-'.concat(country.countryShortCode.toLowerCase()) }}"></mat-icon>
                  {{ country.countryName }}
                </mat-option>
              </mat-select>
              <input
                matInput
                formControlName="country"
                required
                [readonly]="environment.inputs.country.readonly"
                *ngIf="environment.inputs.country.readonly"
              />
              <mat-error *ngIf="registrationFormStep4.get('country').invalid">
                {{ getErrorMessage('registrationFormStep4', 'country') }}
              </mat-error>
            </mat-form-field>
            <mat-form-field appearance="outline">
              <mat-label>State/Province/Region</mat-label>
              <mat-select formControlName="province" required *ngIf="!environment.inputs.province.readonly">
                <mat-option>--</mat-option>
                <mat-option
                  *ngFor="
                    let province of countries[findSelectedCountryIndex('registrationFormStep4')]
                      ? countries[findSelectedCountryIndex('registrationFormStep4')].regions
                      : []
                  "
                  [value]="province.name"
                >
                  {{ province.name }} ({{ province.shortCode }})
                </mat-option>
              </mat-select>
              <input
                matInput
                formControlName="province"
                required
                [readonly]="environment.inputs.province.readonly"
                *ngIf="environment.inputs.province.readonly"
              />
              <mat-error *ngIf="registrationFormStep4.get('province').invalid">
                {{ getErrorMessage('registrationFormStep4', 'province') }}
              </mat-error>
            </mat-form-field>
            <mat-form-field appearance="outline">
              <mat-label>Zip/Postal code</mat-label>
              <input
                matInput
                formControlName="postalCode"
                maxlength="14"
                required
                [value]="registrationFormStep4.get('postalCode').value | uppercase"
                (input)="formatCanadianPostalCode($event, 'registrationFormStep4')"
                placeholder="Ex. J4K 5G7"
                [readonly]="environment.inputs.postalCode.readonly"
              />
              <mat-error *ngIf="registrationFormStep4.get('postalCode').invalid">
                {{ getErrorMessage('registrationFormStep4', 'postalCode') }}
              </mat-error>
            </mat-form-field>
            <mat-form-field appearance="outline">
              <mat-label>Social Insurance Number</mat-label>
              <input
                matInput
                formControlName="socialInsuranceNumber"
                maxlength="11"
                required
                (input)="formatSocialInsuranceNumber($event, 'registrationFormStep4')"
                placeholder="Ex. 111-111-111"
                (blur)="formatSocialInsuranceNumber($event, 'registrationFormStep4')"
                [readonly]="environment.inputs.socialInsuranceNumber.readonly"
              />
              <mat-error *ngIf="registrationFormStep4.get('socialInsuranceNumber').invalid">
                {{ getErrorMessage('registrationFormStep4', 'socialInsuranceNumber') }}
              </mat-error>
            </mat-form-field>
            <mat-form-field appearance="outline">
              <mat-label>Citizenship</mat-label>
              <mat-select formControlName="citizenship" required *ngIf="!environment.inputs.citizenship.readonly">
                <mat-option>--</mat-option>
                <mat-option *ngFor="let country of countries" [value]="country.countryName">
                  <mat-icon svgIcon="{{ 'flag-'.concat(country.countryShortCode.toLowerCase()) }}"></mat-icon>
                  {{ country.countryName }}
                </mat-option>
              </mat-select>
              <input
                matInput
                formControlName="citizenship"
                required
                [readonly]="environment.inputs.citizenship.readonly"
                *ngIf="environment.inputs.citizenship.readonly"
              />
              <mat-error *ngIf="registrationFormStep4.get('citizenship').invalid">
                {{ getErrorMessage('registrationFormStep4', 'citizenship') }}
              </mat-error>
            </mat-form-field>
            <mat-form-field appearance="outline">
              <mat-label>Profession</mat-label>
              <input
                matInput
                formControlName="profession"
                required
                [value]="registrationFormStep4.get('profession').value | titlecase"
                [readonly]="environment.inputs.profession.readonly"
              />
              <mat-error *ngIf="registrationFormStep4.get('profession').invalid">
                {{ getErrorMessage('registrationFormStep4', 'profession') }}
              </mat-error>
            </mat-form-field>
            <mat-form-field appearance="outline">
              <mat-label>Relationship</mat-label>
              <input
                matInput
                type="text"
                formControlName="relationship"
                required
                [matAutocomplete]="auto"
                [value]="registrationFormStep4.get('relationship').value | titlecase"
                placeholder="Ex. Wife"
                [readonly]="environment.inputs.relationship.readonly"
              />
              <mat-autocomplete #auto="matAutocomplete">
                <mat-option *ngFor="let relationshipType of filteredRelationshipTypes | async" [value]="relationshipType">
                  {{ relationshipType }}
                </mat-option>
              </mat-autocomplete>
              <mat-error *ngIf="registrationFormStep4.get('relationship').invalid">
                {{ getErrorMessage('registrationFormStep4', 'relationship') }}
              </mat-error>
            </mat-form-field>
          </form>
        </mat-tab>
      </mat-tab-group>
    </mat-card-content>
  </mat-card>
</div>
